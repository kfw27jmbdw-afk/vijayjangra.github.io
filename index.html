<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Textile Calculator — Final Version</title>
<style>
  :root {
    --bg:#eef6ff; --card:#fff; --accent:#0b63c6; --muted:#334155; --blue:#0a66ff;
  }
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--muted)}
  .wrap{max-width:760px;margin:28px auto;padding:18px}
  .card{max-width:540px;margin:0 auto;background:var(--card);border-radius:14px;box-shadow:0 10px 30px rgba(16,24,40,0.08);padding:20px}
  h1{text-align:center;color:var(--accent);margin:0 0 14px;font-size:20px}
  .tabs{display:flex;gap:10px;margin-bottom:16px}
  .tab{flex:1;padding:10px;border-radius:10px;text-align:center;cursor:pointer;background:linear-gradient(180deg,#bfe0ff,#90caf9);color:#fff;font-weight:700}
  .tab.inactive{background:transparent;color:var(--accent);border:1px solid #cfe8ff}
  .section{display:none}
  .section.active{display:block}
  label{display:block;margin-top:10px;font-size:14px;color:#344054}
  input, select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8;margin-top:6px;background:#fbfdff;font-size:15px}
  .row{display:flex;gap:10px}
  .half{flex:1}
  .btn{margin-top:14px;padding:12px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:700;cursor:pointer}
  .result{margin-top:12px;padding:14px;border-radius:10px;background:#f8fbff;border:1px solid #e6f0ff;font-family:monospace;white-space:pre-line;overflow-x:auto}
  .control-row{display:flex;align-items:center;gap:10px;margin-top:8px}
  .control-row input[type=color]{width:40px;height:30px;border:none;background:none;cursor:pointer}
  .control-row input[type=range]{flex:1}
  .blue-bold{color:var(--blue);font-weight:800}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>🧵 Textile Calculator — Warping & Colour</h1>

    <div class="tabs">
      <div id="tabWarp" class="tab" onclick="activateTab('warp')">Warping</div>
      <div id="tabColor" class="tab inactive" onclick="activateTab('color')">Colour</div>
    </div>

    <!-- WARPING -->
    <div id="warp" class="section active">
      <label>Yarn Type</label>
      <select id="yarnWarp" onchange="syncInputs()">
        <option value="coarse">Coarse</option>
        <option value="fine">Fine</option>
      </select>

      <label>Reed (format: 72/2)</label>
      <input id="reedWarp" placeholder="e.g. 72/2" oninput="syncInputs()" />

      <div class="row">
        <div class="half">
          <label>Width (in inches)</label>
          <input id="widthWarp" type="number" placeholder="e.g. 18" oninput="syncInputs()" />
        </div>
        <div class="half">
          <label>No. of Matches</label>
          <select id="matchesWarp" onchange="syncInputs()">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
        </div>
      </div>

      <button class="btn" onclick="computeWarp()">Get Warping Construction</button>
      <div id="warpOutput" class="result" style="font-size:16px;color:#05203f;">No result yet.</div>

      <div class="control-row">
        <label>Font Size:</label><input id="warpFontSize" type="range" min="12" max="28" value="16" />
        <label>Color:</label><input id="warpFontColor" type="color" value="#05203f" />
      </div>
    </div>

    <!-- COLOUR -->
    <div id="color" class="section">
      <label>Yarn Type</label>
      <select id="yarnColor" onchange="syncInputs()">
        <option value="coarse">Coarse</option>
        <option value="fine">Fine</option>
      </select>

      <label>Reed (format: 72/2)</label>
      <input id="reedColor" placeholder="e.g. 72/2" oninput="syncInputs()" />

      <div class="row">
        <div class="half">
          <label>Width (in inches)</label>
          <input id="widthColor" type="number" placeholder="e.g. 18" oninput="syncInputs()" />
        </div>
        <div class="half">
          <label>No. of Matches</label>
          <select id="matchesColor" onchange="syncInputs()">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
        </div>
      </div>

      <label>Repeat Ends (one repeat)</label>
      <input id="repeatEnds" type="number" placeholder="e.g. 24" oninput="computeColorLive()" />

      <label>Multiplier (live auto)</label>
      <input id="multiplier" type="number" placeholder="e.g. 5" oninput="computeColorLive()" />

      <div id="colorOutput" class="result" style="font-size:16px;color:#05203f;">No result yet.</div>

      <div class="control-row">
        <label>Font Size:</label><input id="colorFontSize" type="range" min="12" max="28" value="16" />
        <label>Color:</label><input id="colorFontColor" type="color" value="#05203f" />
      </div>
    </div>
  </div>
</div>

<script>
function activateTab(name){
  document.getElementById('warp').classList.remove('active');
  document.getElementById('color').classList.remove('active');
  document.getElementById('tabWarp').classList.remove('inactive');
  document.getElementById('tabColor').classList.remove('inactive');

  if(name==='warp'){
    document.getElementById('warp').classList.add('active');
    document.getElementById('tabColor').classList.add('inactive');
  } else {
    document.getElementById('color').classList.add('active');
    document.getElementById('tabWarp').classList.add('inactive');
  }
}

// shared input sync
function syncInputs(){
  const ids = ['yarn','reed','width','matches'];
  ids.forEach(id=>{
    const warp=document.getElementById(id+'Warp');
    const color=document.getElementById(id+'Color');
    if(document.activeElement===warp) color.value=warp.value;
    if(document.activeElement===color) warp.value=color.value;
  });
  computeColorLive();
}

// parse reed like 72/2
function parseReed(v){
  if(!v) return null;
  const p=v.replace(/\s+/g,'').split('/');
  const n=parseFloat(p[0]), d=parseFloat(p[1]);
  if(isNaN(n)||isNaN(d)) return null;
  return {n,d};
}

// compute warp
function computeWarp(){
  const yarn=document.getElementById('yarnWarp').value;
  const reed=parseReed(document.getElementById('reedWarp').value);
  const width=parseFloat(document.getElementById('widthWarp').value);
  const matches=parseInt(document.getElementById('matchesWarp').value);
  const out=document.getElementById('warpOutput');

  if(!reed||isNaN(width)||width<=0){out.innerText="⚠️ Invalid inputs";return;}
  const epi=(reed.n/2)*reed.d;
  const total=Math.round(epi*width);
  const totalSelv=yarn==='fine'?300:200;
  const eachSelv=totalSelv/2;
  const mid=yarn==='fine'?30:20;
  const midTot=(matches-1)*mid;
  const bodyTot=total-totalSelv;
  const dist=bodyTot-midTot;
  const base=Math.floor(dist/matches);
  const parts=new Array(matches).fill(base);
  let cur=1;const ranges=[];
  ranges.push({label:'Left Selvage',start:cur,end:cur+eachSelv-1});cur+=eachSelv;
  for(let i=0;i<matches;i++){
    ranges.push({label:`Body ${i+1}`,start:cur,end:cur+parts[i]-1});cur+=parts[i];
    if(i<matches-1){ranges.push({label:'Mid Selvage',start:cur,end:cur+mid-1});cur+=mid;}
  }
  ranges.push({label:'Right Selvage',start:cur,end:total});
  let txt=`EPI: ${epi.toFixed(2)}\nTotal Ends: ${total}\n\nWarping Construction:\n`;
  ranges.forEach(r=>txt+=`${r.start}-${r.end} ${r.label}\n`);
  out.innerText=txt;
  computeColorLive();
}

// compute color
function computeColorLive(){
  const yarn=document.getElementById('yarnColor').value;
  const reed=parseReed(document.getElementById('reedColor').value);
  const width=parseFloat(document.getElementById('widthColor').value);
  const matches=parseInt(document.getElementById('matchesColor').value);
  const repeat=parseFloat(document.getElementById('repeatEnds').value);
  const multi=parseFloat(document.getElementById('multiplier').value);
  const out=document.getElementById('colorOutput');
  if(!reed||isNaN(width)||width<=0){out.innerText="⚠️ Invalid inputs";return;}
  const epi=(reed.n/2)*reed.d;
  const total=Math.round(epi*width);
  const totalSelv=yarn==='fine'?300:200;
  const mid=yarn==='fine'?30:20;
  const midTot=(matches-1)*mid;
  const bodyTot=total-totalSelv;
  const dist=bodyTot-midTot;
  const bodyPer=Math.floor(dist/matches);
  const div=repeat?bodyPer/repeat:null;
  const final=(div&&multi)?div*multi:null;
  let text=`Body Total: ${bodyTot}\nBody/Match: ${bodyPer}\nRepeat: ${repeat||'—'}\nDivision: ${div?div.toFixed(4):'—'}\nMultiplier: ${multi||'—'}\n\nFinal: ${final?'<span class="blue-bold">'+final.toFixed(4)+'</span>':'—'}`;
  out.innerHTML=text;
}

// font customization
function setupFontControls(idOut,idSize,idColor){
  const out=document.getElementById(idOut);
  const s=document.getElementById(idSize);
  const c=document.getElementById(idColor);
  const update=()=>{out.style.fontSize=s.value+'px';out.style.color=c.value;}
  s.addEventListener('input',update);
  c.addEventListener('input',update);
}
setupFontControls('warpOutput','warpFontSize','warpFontColor');
setupFontControls('colorOutput','colorFontSize','colorFontColor');
</script>
</body>
</html>
